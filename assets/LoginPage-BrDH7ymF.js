import{r as d,u as b,z as N,j as e,N as S,D as w,E as m,G as u,H as x,J as h,I as p,K as j,B as y,X as F,F as I}from"./index-B8aywGUI.js";import{L as v}from"./loader-circle-CjdA97Rq.js";const C=()=>{const[n,l]=d.useState(""),[r,i]=d.useState(!1),c=b(),o=N({defaultValues:{email:"",password:""}}),f=async a=>{l(""),i(!0);const g="http://localhost:3001/api/login";try{const s=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await s.json();if(!s.ok)throw new Error(t.error||`HTTP error! status: ${s.status}`);localStorage.setItem("authToken",t.token),localStorage.setItem("userData",JSON.stringify(t.user)),t.user.role==="ADMIN"||t.user.role==="SUPERADMIN"?c("/admin"):c("/")}catch(s){console.error("Erreur lors de la connexion:",s),l(s.message||"Une erreur est survenue."),localStorage.removeItem("authToken"),localStorage.removeItem("userData")}finally{i(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsx("main",{className:"pt-20 min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"max-w-md w-full mx-auto p-6 bg-card text-card-foreground rounded-lg shadow-md border border-border",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-center",children:"Connexion"}),e.jsx(w,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(f),className:"space-y-6",children:[e.jsx(m,{control:o.control,name:"email",rules:{required:"Email est requis"},render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Email"}),e.jsx(h,{children:e.jsx(p,{type:"email",placeholder:"nom@exemple.com",...a,disabled:r})}),e.jsx(j,{})]})}),e.jsx(m,{control:o.control,name:"password",rules:{required:"Mot de passe est requis"},render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Mot de passe"}),e.jsx(h,{children:e.jsx(p,{type:"password",placeholder:"********",...a,disabled:r})}),e.jsx(j,{})]})}),n&&e.jsx("p",{className:"text-sm text-red-600",children:n}),e.jsxs(y,{type:"submit",className:"w-full",disabled:r,children:[r&&e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Connexion...":"Se Connecter"]})]})}),e.jsxs("p",{className:"mt-4 text-center text-sm",children:["Pas encore de compte ? ",e.jsx(F,{to:"/create-user",className:"text-indigo-600 hover:underline",children:"Inscrivez-vous"})]})]})}),e.jsx(I,{})]})};export{C as default};
